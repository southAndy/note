"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[2382],{5612:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>l,default:()=>a,frontMatter:()=>i,metadata:()=>o,toc:()=>t});var s=n(4848),c=n(8453);const i={},l="[JS] Promise",o={id:"Javascript/promise",title:"[JS] Promise",description:"Promise \u57fa\u672c\u4ecb\u7d39",source:"@site/docs/Javascript/promise.md",sourceDirName:"Javascript",slug:"/Javascript/promise",permalink:"/docs/Javascript/promise",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"techNoteSidebar",previous:{title:"[JS] Destructuring",permalink:"/docs/Javascript/js-Destructuring"},next:{title:"[JS] Event Loop",permalink:"/docs/Javascript/[js]eventloop"}},d={},t=[{value:"Promise \u57fa\u672c\u4ecb\u7d39",id:"promise-\u57fa\u672c\u4ecb\u7d39",level:3},{value:"\u5982\u4f55\u5275\u5efa Promise",id:"\u5982\u4f55\u5275\u5efa-promise",level:3},{value:"Promise \u7684\u65b9\u6cd5",id:"promise-\u7684\u65b9\u6cd5",level:3},{value:"\u5982\u4f55\u9078\u64c7 <code>catch</code> \u6216 <code>then</code> \u4f5c\u932f\u8aa4\u8655\u7406\uff1f",id:"\u5982\u4f55\u9078\u64c7-catch-\u6216-then-\u4f5c\u932f\u8aa4\u8655\u7406",level:3},{value:"\u4f55\u6642\u8a72\u7528 Promise \u800c\u4e0d\u662f async/await\uff1f",id:"\u4f55\u6642\u8a72\u7528-promise-\u800c\u4e0d\u662f-asyncawait",level:3}];function h(e){const r={admonition:"admonition",code:"code",h1:"h1",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h1,{id:"js-promise",children:"[JS] Promise"}),"\n",(0,s.jsx)(r.h3,{id:"promise-\u57fa\u672c\u4ecb\u7d39",children:"Promise \u57fa\u672c\u4ecb\u7d39"}),"\n",(0,s.jsx)(r.p,{children:"Promise \u662f\u4e00\u500b\u7269\u4ef6\uff0c\u4ee3\u8868\u975e\u540c\u6b65\u64cd\u4f5c\u7684\u7d50\u679c\uff0c\u7576\u6211\u5011\u767c\u8d77\u4e00\u500b\u975e\u540c\u6b65\u64cd\u4f5c\u6642\uff0cPromise \u6703\u5728\u672a\u4f86\u7684\u67d0\u500b\u6642\u9593\u9ede\u7d66\u6211\u5011\u4e00\u500b\u7d50\u679c\u3002"}),"\n",(0,s.jsx)(r.h3,{id:"\u5982\u4f55\u5275\u5efa-promise",children:"\u5982\u4f55\u5275\u5efa Promise"}),"\n",(0,s.jsxs)(r.p,{children:["\u8981\u4f7f\u7528 ",(0,s.jsx)(r.code,{children:"new"})," \u95dc\u9375\u5b57\u4f86\u5275\u5efa Promise \u7269\u4ef6\uff0c\u9019\u500b\u88ab\u7a31\u70ba excutor \uff0cexcutor \u9700\u8981\u50b3\u5165\u4e00\u500b\u51fd\u5f0f\uff0c",(0,s.jsx)(r.strong,{children:"\u9019\u500b\u51fd\u5f0f\u6703\u7acb\u523b\u57f7\u884c"}),"\uff0c\u800c\u5b83\u5305\u542b\u5169\u500b\u53c3\u6578 ",(0,s.jsx)(r.code,{children:"resolve"})," \u548c ",(0,s.jsx)(r.code,{children:"reject"}),"\uff0c\u5206\u5225\u4ee3\u8868\u975e\u540c\u6b65\u64cd\u4f5c\u6210\u529f\u548c\u5931\u6557\u7684\u56de\u8abf\u51fd\u6578\uff0c"]}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["\u7576\u57f7\u884c ",(0,s.jsx)(r.code,{children:"resolve"})," \u6642\uff1a\u72c0\u614b\u6703\u5f9e pending \u8f49\u8b8a\u70ba fulfilled\uff0c\u4e26\u4e14\u6703\u57f7\u884c ",(0,s.jsx)(r.code,{children:"resolve"})," \u7684\u56de\u8abf\u51fd\u6578"]}),"\n",(0,s.jsxs)(r.li,{children:["\u7576\u57f7\u884c ",(0,s.jsx)(r.code,{children:"reject"})," \u6642\uff1a\u72c0\u614b\u6703\u5f9e pending \u8f49\u8b8a\u70ba rejected\uff0c\u4e26\u4e14\u6703\u57f7\u884c ",(0,s.jsx)(r.code,{children:"reject"})," \u7684\u56de\u8abf\u51fd\u6578"]}),"\n",(0,s.jsxs)(r.li,{children:["\u7576\u6c92\u6709\u57f7\u884c ",(0,s.jsx)(r.code,{children:"resolve"})," \u6216 ",(0,s.jsx)(r.code,{children:"reject"})," \u6642\uff1a\u72c0\u614b\u6703\u4e00\u76f4\u4fdd\u6301\u5728 pending \u72c0\u614b\uff0c\u76f4\u5230\u6709\u7d50\u679c\u70ba\u6b62"]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"const promise = new Promise((resolve, reject) => {\n    // fullfilled\n    resolve('\u6210\u529f');\n    // rejected\n    reject('\u5931\u6557');\n});\n"})}),"\n",(0,s.jsxs)(r.admonition,{type:"warning",children:[(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"\u72c0\u614b\u4e00\u65e6\u5f9e pending \u8f49\u8b8a\u70ba fulfilled \u6216 rejected \u5f8c\u5c31\u4e0d\u6703\u518d\u6539\u8b8a\u3002"}),(0,s.jsx)("br",{}),"\u70ba\u4ec0\u9ebc\u8981\u7279\u5225\u5f37\u8abf\u9019\u4e00\u9ede\u5462\uff1f\u56e0\u70ba\u9019\u662f Promise \u91cd\u8981\u7684\u7279\u6027\u4e4b\u4e00\uff0c\u5b83\u7684\u72c0\u614b\u662f\u6709\u53ef\u9810\u671f\u6027\uff0c\u4ee5\u4e0b\u9762\u7c21\u55ae\u4f8b\u5b50\u4f86\u8aaa\uff0c"]}),(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-js",children:"const promise = new Promise((resolve, reject) => {\n    setTimeout(() => {reject('\u5931\u6557')},1000)\n    resolve('\u5931\u6557');\n});\n"})}),(0,s.jsxs)(r.p,{children:["\u5373\u4fbf\u6709\u4e00\u500b\u975e\u540c\u6b65\u64cd\u4f5c\u5728 1 \u79d2\u5f8c\u57f7\u884c ",(0,s.jsx)(r.code,{children:"reject('\u5931\u6557')"}),"\uff0cPromise \u7684\u72c0\u614b\u4e5f\u4e0d\u6703\u5f9e fulfilled \u8f49\u8b8a\u70ba rejected\uff0c\u800c\u662f\u4fdd\u6301 fulfilled \u72c0\u614b\u3002"]})]}),"\n",(0,s.jsx)(r.h3,{id:"promise-\u7684\u65b9\u6cd5",children:"Promise \u7684\u65b9\u6cd5"}),"\n",(0,s.jsxs)(r.p,{children:["\u900f\u904e ",(0,s.jsx)(r.code,{children:"then"})," \u65b9\u6cd5\u53ef\u627f\u63a5 excutor \u4e2d fullfilled / rejected \u72c0\u614b\u7684\u56de\u50b3\u503c\uff0c\u5b83\u63d0\u4f9b\u5169\u500b\u53c3\u6578\uff0c\u5206\u5225\u4f5c\u70ba fullfilled \u548c rejected \u7684\u56de\u8abf\u51fd\u6578"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"promise.then(fullfilledHandler, rejectedHandler)\n"})}),"\n",(0,s.jsxs)(r.p,{children:["\u9664\u6b64\u4e4b\u5916\uff0c",(0,s.jsx)(r.code,{children:"catch"})," \u662f\u5c08\u9580\u7528\u4f86\u8655\u7406 rejected \u72c0\u614b\u7684\u65b9\u6cd5"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"promise.catch(rejectedHandler)\n"})}),"\n",(0,s.jsxs)(r.p,{children:["\u7576 ",(0,s.jsx)(r.code,{children:"then"})," \u4e2d\u89f8\u767c rejected \u72c0\u614b\u6642\uff0c",(0,s.jsx)(r.code,{children:"catch"})," \u6703\u6355\u6349\u5230\u9019\u500b\u932f\u8aa4\uff0c\u4e26\u4e2d\u65b7\u5f8c\u7e8c ",(0,s.jsx)(r.code,{children:"then"})," \u7684\u57f7\u884c\uff0c\u76f4\u63a5\u57f7\u884c ",(0,s.jsx)(r.code,{children:"catch"})," \u7684\u56de\u8abf\u51fd\u6578\uff0c\u5982\u4e0b\u9762\u7bc4\u4f8b\uff1a"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:'new Promise((resolve, reject) => {\n  resolve("Step 1: Success");\n})\n  .then((result) => {\n    console.log(result); // \u6253\u5370\u7b2c\u4e00\u500b\u6b65\u9a5f\u7684\u7d50\u679c\n    return "Step 2: Success"; // \u50b3\u905e\u7d66\u4e0b\u4e00\u500b .then()\n  })\n  .then((result) => {\n    console.log(result); // \u6253\u5370\u7b2c\u4e8c\u500b\u6b65\u9a5f\u7684\u7d50\u679c\n    throw new Error("Step 2: Error occurred!"); // \u5728\u9019\u88e1\u6545\u610f\u62cb\u51fa\u932f\u8aa4\n  })\n  .then((result) => {\n    // \u9019\u500b\u6b65\u9a5f\u5c07\u4e0d\u6703\u57f7\u884c\uff0c\u56e0\u70ba\u524d\u9762\u5df2\u7d93\u6709\u932f\u8aa4\n    console.log(result); \n    return "Step 3: Success";\n  })\n  .catch((error) => {\n    // \u932f\u8aa4\u6703\u88ab\u9019\u88e1\u7684 .catch() \u6355\u7372\n    console.error("Caught error:", error.message);\n  });\n'})}),"\n",(0,s.jsxs)(r.p,{children:["\u5269\u9918 ",(0,s.jsx)(r.code,{children:"all"})," / ",(0,s.jsx)(r.code,{children:"race"})," / ",(0,s.jsx)(r.code,{children:"any"})," / ",(0,s.jsx)(r.code,{children:"allSettled"})," \u90fd\u662f Promise \u7528\u4f86\u8655\u7406\u591a\u500b Promise \u7d44\u5408\u7684\u65b9\u6cd5\u3002\u5b83\u5011\u7684\u5dee\u7570\u5728\u65bc\uff1a"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"Promise.all()"}),"\uff1a\u53ea\u6709\u7576\u6240\u6709\u539f\u59cb\u7684 Promise \u90fd\u6210\u529f\u6642\uff0c\u624d\u6703\u6210\u529f resolve\uff0c\u5426\u5247\u53ea\u8981\u6709\u4e00\u500b Promise \u5931\u6557\uff0c\u5c31\u6703\u7acb\u523b reject\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"Promise.race()"}),"\uff1a\u53ea\u8981\u6709\u4e00\u500b\u539f\u59cb\u7684 Promise \u6210\u529f\u6216\u5931\u6557\uff0c\u5c31\u53ef\u6210\u529f resolve"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"Promise.any()"}),"\uff1a\u53ea\u8981\u6709\u4e00\u500b\u539f\u59cb\u7684 Promise \u6210\u529f\uff0c\u65b0\u7684 Promise \u5c31\u6703\u6210\u529f\uff0c\u5426\u5247\u53ea\u8981\u6240\u6709\u539f\u59cb\u7684 Promise \u90fd\u5931\u6557\uff0c\u65b0\u7684 Promise \u5c31\u6703\u5931\u6557\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"Promise.allSettled()"}),"\uff1a\u4e0d\u7ba1\u539f\u59cb\u7684 Promise \u662f\u6210\u529f\u9084\u662f\u5931\u6557\uff0c\u65b0\u7684 Promise \u90fd\u6703\u6210\u529f\uff0c\u4e26\u4e14\u6703\u5305\u542b\u6240\u6709\u539f\u59cb Promise \u7684\u7d50\u679c\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["\u4ee5\u53ca ",(0,s.jsx)(r.code,{children:"finally"})," \u65b9\u6cd5\uff0c\u4e0d\u8ad6\u539f\u59cb\u7684 Promise \u662f\u6210\u529f\u9084\u662f\u5931\u6557\uff0c\u65b0\u7684 Promise \u90fd\u6703\u57f7\u884c ",(0,s.jsx)(r.code,{children:"finally"})," \u7684\u56de\u8abf\u51fd\u6578\u3002"]}),"\n",(0,s.jsxs)(r.h3,{id:"\u5982\u4f55\u9078\u64c7-catch-\u6216-then-\u4f5c\u932f\u8aa4\u8655\u7406",children:["\u5982\u4f55\u9078\u64c7 ",(0,s.jsx)(r.code,{children:"catch"})," \u6216 ",(0,s.jsx)(r.code,{children:"then"})," \u4f5c\u932f\u8aa4\u8655\u7406\uff1f"]}),"\n",(0,s.jsxs)(r.p,{children:["\u4e0a\u9762\u63d0\u5230 ",(0,s.jsx)(r.code,{children:"catch"})," \u548c ",(0,s.jsx)(r.code,{children:"then"})," \u90fd\u53ef\u4ee5\u7528\u4f86\u8655\u7406\u932f\u8aa4\uff0c\u90a3\u9ebc\u5230\u5e95\u8a72\u9078\u64c7\u54ea\u4e00\u500b\u5462\uff1f"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"promise.then(fullfilledHandler, rejectedHandler)\n// \u7b49\u540c\u65bc\npromise.then(fullfilledHandler).catch(rejectedHandler)\n"})}),"\n",(0,s.jsx)(r.p,{children:"\u6700\u7c21\u55ae\u4f86\u8aaa\u5c31\u662f"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.strong,{children:"\u662f\u5426\u6703\u6709\u4e0d\u540c\u932f\u8aa4\u60c5\u5883\u8981\u8655\u7406\uff1f"})}),"\n",(0,s.jsx)(r.li,{children:"\u932f\u8aa4\u8a0a\u606f\u683c\u5f0f\u662f\u5426\u4e00\u81f4\uff1f"}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["\u5047\u8a2d\u4f60\u7b26\u5408\u4e0a\u8ff0\u4efb\u4e00\u60c5\u5883\uff0c\u90a3\u9ebc ",(0,s.jsx)(r.code,{children:"then"})," \u6703\u662f\u6bd4\u8f03\u597d\u7684\u9078\u64c7\u3002"]}),"\n",(0,s.jsxs)(r.p,{children:["\u8209\u500b\u4f8b\u5b50\uff0c\u5047\u8a2d\u4eca\u5929\u4f60\u8981\u4e32\u63a5\u5169\u500b API\uff0c\u7576\u7b2c\u4e00\u500b API \u8b80\u53d6\u5931\u6557\u6642\uff0c\u4f60\u8981\u6253\u4e00\u96bb\u540d\u70ba ",(0,s.jsx)(r.code,{children:"notifyFailure"})," API \u901a\u77e5\u5f8c\u7aef\uff0c\u4f46\u7b2c\u4e8c\u500b API \u8b80\u53d6\u5931\u6557\u6642\uff0c\u5247\u4e0d\u9808\u901a\u77e5\u5f8c\u7aef\u50c5\u9700\u8981\u56de\u50b3\u932f\u8aa4\u8a0a\u606f\uff0c\u4f7f\u7528 ",(0,s.jsx)(r.code,{children:"then"})," \u80fd\u500b\u5225\u8655\u7406\u9019\u5169\u7a2e\u60c5\u5883\u3002"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"new Promise((resolve, reject) => {\n    // \u6a21\u64ec\u7b2c\u4e00\u500b API \u8b80\u53d6\u5931\u6557\n    reject('Error from API 1');\n})\n.then(result => {\n    // \u7b2c\u4e00\u96bb API \u8b80\u53d6\u6210\u529f\u6642\uff0c\u57f7\u884c\u7b2c\u4e8c\u96bb API\n    return 'API 2 Success';\n}, error => {\n    // \u7b2c\u4e00\u96bb API \u8b80\u53d6\u5931\u6557\n    notifyFailure(error);\n}).then(result => {\n    // \u7b2c\u4e8c\u96bb API \u8b80\u53d6\u6210\u529f\n    return 'API 2 Success';\n}, error => {\n    // \u7b2c\u4e8c\u96bb API \u8b80\u53d6\u5931\u6557\n    console.log(error);\n})\n"})}),"\n",(0,s.jsxs)(r.p,{children:["\u4f46\u82e5\u4f60\u4eca\u5929\u53ea\u6709\u4e00\u7a2e\u932f\u8aa4\u8655\u7406\u60c5\u5883\uff0c\u90a3\u9ebc ",(0,s.jsx)(r.code,{children:"catch"})," \u6703\u662f\u6bd4\u8f03\u597d\u7684\u9078\u64c7\u3002"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"new Promise((resolve, reject) => {\n    // \u6a21\u64ec API \u8b80\u53d6\u5931\u6557\n    reject('API Error');\n})\n.catch(error => {\n    // \u6355\u6349\u5230\u932f\u8aa4\n    console.log(error);\n});\n"})}),"\n",(0,s.jsx)(r.h3,{id:"\u4f55\u6642\u8a72\u7528-promise-\u800c\u4e0d\u662f-asyncawait",children:"\u4f55\u6642\u8a72\u7528 Promise \u800c\u4e0d\u662f async/await\uff1f"}),"\n",(0,s.jsx)(r.p,{children:"\u7db2\u8def\u4e0a\u5df2\u7d93\u6709\u8a31\u591a\u6587\u7ae0\u63d0\u5230 Promise \u89e3\u6c7a\u4e86 callback hell \u7684\u554f\u984c\uff0c\u4f46\u73fe\u5728\u591a\u6578\u7684\u975e\u540c\u6b65\u4e32\u63a5\u90fd\u662f\u4f7f\u7528 async/await \u4f86\u5beb\uff0c\u90a3\u9ebc\u4ec0\u9ebc\u6642\u5019\u8a72\u7528 Promise \u800c\u4e0d\u662f async/await \u5462\uff1f"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u9700\u8981\u540c\u6642\u57f7\u884c\u591a\u500b\u975e\u540c\u6b65\u64cd\u4f5c"}),"\uff1a\u82e5\u662f\u9700\u8981\u540c\u6642\u57f7\u884c\u591a\u500b\u975e\u540c\u6b65\u64cd\u4f5c\uff0c\u90a3\u9ebc\u4f7f\u7528 Promise \u6703\u6bd4\u8f03\u65b9\u4fbf\uff0c\u56e0\u70ba\u53ef\u4ee5\u4f7f\u7528 ",(0,s.jsx)(r.code,{children:"Promise.all"})," \u65b9\u6cd5\u4f86\u5be6\u73fe\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsxs)(r.strong,{children:["\u4e0d\u5728 ",(0,s.jsx)(r.code,{children:"async"})," \u51fd\u5f0f\u5167\u9032\u884c\u975e\u540c\u6b65\u64cd\u4f5c"]}),"\uff1a\u50cf\u662f ",(0,s.jsx)(r.code,{children:"setTimeout"})," , ",(0,s.jsx)(r.code,{children:"addEventListener"})," \u7b49\u51fd\u6578\uff0c\u9019\u4e9b\u51fd\u6578\u7684\u56de\u8abf\u51fd\u6578\u901a\u5e38\u4e0d\u6703\u6a19\u8a18 ",(0,s.jsx)(r.code,{children:"async"}),"\uff0c\u9019\u6642\u5019\u5c31\u6703\u9700\u8981\u7528\u5230 ",(0,s.jsx)(r.code,{children:"Promise"})," \u4f86\u9032\u884c\u975e\u540c\u6b65\u64cd\u4f5c\u3002"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\u4e0d\u9700\u8981\u7b49\u5f85\u7684\u975e\u540c\u6b65\u884c\u70ba"}),"\uff1a\u82e5\u662f\u975e\u540c\u6b65\u884c\u70ba\u4e0d\u9700\u8981\u7b49\u5f85\uff0c\u90a3\u9ebc\u4f7f\u7528 Promise \u6703\u6bd4\u8f03\u65b9\u4fbf\u3002"]}),"\n"]})]})}function a(e={}){const{wrapper:r}={...(0,c.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>l,x:()=>o});var s=n(6540);const c={},i=s.createContext(c);function l(e){const r=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);