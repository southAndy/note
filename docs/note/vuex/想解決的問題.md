#vuex 


### vuex 概念

單向資料流、單一資料管理 (single source tree)，全部資料統一管在 vuex


狀態不可直接更改，而是需要統一透過通知(dispatch) vuex 更新(mutation) 資料
![[Pasted image 20241118135105.png]]

## 想解決問題

### 元件狀態同步問題

假設今天你所需狀態的兩個元件是 **兄弟元件**，所謂的兄弟元件

當你更新 A 時，B 的狀態不會同步更新，這樣就會造成畫面顯示不統一
```
- ComponentA (state:A)
- ComponentB (state:B)
```

####  解方：狀態改由母層統一提供
新增一個共同母層，將狀態提升到共同母層存放，這樣就解決**狀態更新不同步問題**。
```
- ParentComponent(state:A)
	- ComponentA (props:A)
	- ComponentB (props:A)
```

在子層可透過 `@emit` 提醒母層更新狀態

```js
@emit('handler',newState)
```

但這有機會遇到兩個問題：

1.巢狀架構下的維護成本
當今天狀態是要傳遞多層元件時（如下圖），為了維持所有元件狀態，所需撰寫的程式碼也越來越多，同時提高錯誤發生率。

如果狀態在最下層發生變化，要往上更新四層，才能讓所有元件都維持相同狀態。
```
- ParentComponent(state:A)
	- ComponentA (props:A)
		- ComponentA (props:A)
			- ComponentA (props:A)
				- ComponentA (props:A)
```

2.是否為了狀態傳遞鴯新增多餘的母層元件

```
- ParentComponent(state:A)
	- ComponentA (props:A)
	- ComponentB (props:A)

```
這個 ParentComponent 是必要的嗎？

### 提升狀態可追蹤性

因為在 vuex 有一套固定的資料更新方式

流程皆為：
1. 元件觸發 `actions` 
2. `actions` dispatch Vuex 觸發對應操作 `mutations` 
3. 透過 `mutation` 去更新特定 `state` 
4. 元件讀取新的 `state`


還可以進一步在 `action` 內新增日誌 (log),時間戳記 (time log) ，來追蹤功能觸發位置，或是錯誤處理
```js
actions:{
	doSomething({state,commit},payload){
		//新增日誌 / 時間日誌 / 
	}
}
```

1. 同步操作可直接呼叫 `mutation` 不用經過 `actions` ，但是為了維持資料更新方式一致
2. 也可直接更新 `state` 也能觸發畫面更新渲染，這種改動沒辦法在 vue devtol 追蹤

```js
//能觸發畫面更新渲染
this.$store.state.test = 1
//這種改動沒辦法在 vue devtol 追蹤
```