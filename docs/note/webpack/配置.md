#webpack 


### 選擇 webpack 配置(*config*)

透過`--config [configName]`選擇你在不同專案客製化的 *webpack* 配置，如下：
```shell
npx webpack --config:[configName]
```

---

## Asset Management

>gulp/grunt 處理asset ？


### 加載 *css* 樣式

為了在 *JavaScript-module* 內載入`.css`使用寫好的樣式，你可以透過安裝對應的 *loader*，並將它添加在*webpack* 的配置(*config*)內的`module`：

```javascript
//webpack.config.js

const path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
  },
    //新增至模組的部分
  module:{
    rules:
      [
        {
      test:/\.css$/i,
      use:['style-loader', 'css-loader']
    },
      ]
  }
};
```
裡面`rules`的部分：

1. `test`:檢驗檔案是否套用模組內容的條件（多是使用正則）
2. `use`:符合`test`的內容會套用的模組內容

> use 呼叫的方法會依照索引值順序來執行


根據文件：
>Module loaders can be chained. Each loader in the chain applies transformations to the processed resource

不知道 module loaders 是指哪個部分？


### 加載 *Data*

常見的資料
    

---

## 輸出（Output Management）
 

在前面有提到：
>`output`屬性是設定建置完成的 *bundle* 要放在哪個目錄以及如何命名。
```js
const path = require("path"); 
module.exports = 
{ output: 
	{ 
	path: path.join(process.cwd(), "dist"), 
	filename: "[name].js", 
	}, 
	
};
```
- `path`定義了 bundle 輸出的路徑，預設是在執行建置工作目錄下的 `dist` 目錄中。
- `filename` 定義生成的檔名，預設是使用template-string 的方式  *webpack-templatePathPlugin* ，這樣可以依照 #chunk 名稱生成對應的檔案。


### - 關於 `path`

這個屬性用來設定輸出的目錄，配置內容須為**絕對路徑(absolute path)**。
> 絕對路徑 ＆ 相對路徑 比較
> 1. 相對路徑：就是根據當前位置作為出發點路徑
> 2. 絕對路徑：就是那個*內容的所在位置*不因為當前位置不同而會有不同，如下：
> **架構**
> | - ------ src / index.js （當前位置）
> | -------- assets / image/sample.png
> **方法**
> 今天的情境是要找到 *sample.png*：
> 用相對路徑 ： ./assets/image/sample.png
用絕對路徑： file:///D:/assets/image/sample.png

知道了什麼是絕對路徑後，來看看 `path` 有哪些設定方法：

1. 在配置檔進行設定 
```js
//webpack.config.js

const path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    //1.直接寫法
    path:'file:///D:/assets/image/sample.png'
    //2.透過 node 內建的方法，幫你產生絕對路徑
    path: path.resolve(__dirname, 'dist'),
    
  },
   
};
```


2. 直接在 json檔內設定：
```json
// ./demos/output-path/package.json
{
    ...
  "scripts": {
    "build:argv": "webpack --output-path $PWD/build",
    "build:argv2": "webpack --output-path build"
    ...
  },
  ...
}
```
`--output-path` 可以設定輸出路徑，雖然可以使用相對路徑做設定，但**避免問題還是請使用絕對路徑做設置**。



### - 關於 `fileName`


`filename` 設定 bundle 輸出的檔案名稱，它有三種設定方式：
-   字串值
-   函式
-   在 `.Json` 直接設定 

```js
//webpack.config.js

const path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
	  //1.直接使用（適用只需產生單一靜態 chunk)
    filename: 'bundle.js',
    //2.使用 template-string （適用需產生多個 chunk 的情境） -- default-setting
    filename:'[name].js'
    path: path.resolve(__dirname, 'dist'),
  },
};
```
在 `.Json` 直接設定 
```json
// ./demos/output-path/package.json
{
    ...
  "scripts": {
    "build:argv": "webpack --output-filename bundle.js",
	//**** 也可透過相對路徑格式，建制輸出的目錄結構
    "build:argv": "webpack --output-filename src/bundle.js",
    ...
  },
  ...
}
```

---

### 官方文件情境

隨著專案架構複雜化像是：

1.  開始需要`-`的檔案名稱 (header-button) 
2.  需要輸出(*output*)多個打包內容(*bundle*)時

架構修改：
```diff
webpack-demo
  |- package.json
  |- package-lock.json
  |- webpack.config.js
  |- /dist
  |- /src
    |- index.js
+   |- print.js
  |- /node_modules
```

config:
```js (webpack.config.js)
const path = require('path');

 module.exports = {
	//entry: './src/index.js',
+  entry: {
+    index: './src/index.js',
+    print: './src/print.js',
+  },
   output: {
-    //filename: 'bundle.js',
+    filename: '[name].bundle.js',
     path: path.resolve(__dirname, 'dist'),
     
   },
 };
```

這樣的設定可能產生的後續問題如下：
>引用文件：
>But what would happen if we changed the name of one of our entry points, or even added a new one? The generated bundles would be renamed on a build, but our `index.html` file would still reference the old names. Let's fix that with the [`HtmlWebpackPlugin`](https://webpack.js.org/plugins/html-webpack-plugin).
>當我們修改、新增入口(`entry`)的檔案名稱時，*webpack*會根據設定打包，但 `index.html` 依然會指向舊的檔案名稱（會造成報錯？！）


---
### 參考：
1. [ 尋覓 webpack - 10 - 配置 webpack - 輸出 Output](https://ithelp.ithome.com.tw/articles/10243632)
2. [webpack-official-doc](https://webpack.js.org/)


--- 
## 開發模式 Development

> **注意**：在下面使用的 *tools* 是專屬於 development 這個模式 *mode* 使用，請勿於其他模式使用

當你將數個 `.js` 的內容以 *single-entry（單一路徑）*   方式打包後，當任一檔案內容出錯，
```js 
//webpack.config.js

const path = require('path');

 module.exports = {
	//entry: './src/index.js',
+  entry: ['./src/index.js','./src/new.js'],
   output: {
-    filename: 'bundle.js',
     path: path.resolve(__dirname, 'dist'),
   },
 };
```
若沒有在`mode`進行設定，報錯顯示路徑會停在最終的打包檔案位置： `bundle.js` 上

![[Pasted image 20221031115748.png]]
但實際上，上面的錯誤內容是來自其中的`new.js` 錯誤內容如下：
```js
export default function printMe() {

cosnole.log('I get called from print.js!');

}
```


這時候你就需要`mode`上加入設定：
```js
const path = require('path');

 module.exports = {
   mode:'development',
+  entry: {
+    index: './src/index.js',
+    print: './src/print.js',
+  },
   output: {
-    //filename: 'bundle.js',
+    filename: '[name].bundle.js',
     path: path.resolve(__dirname, 'dist'),
     
   },
 };
```

![[Pasted image 20221031122005.png]]
